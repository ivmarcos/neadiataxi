angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate","$rootScope",function(a,b,c){"use strict";function d(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var f=0,g=!1;return{restrict:"A",transclude:"element",priority:1e3,compile:function(){return function(a,h,i,j,k){function l(){a.$$postDigest(function(){u.width(v.width()),u.height(v.height()),s.$digest(),w(t,s,!0)})}var m,n=i.fastRepeat.split(" in "),o=n[1],p=n[0],q=b(o),r={},s=a.$new();s[p]=q(s)[0]||{},s.fastRepeatStatic=!0,s.fastRepeatDynamic=!1;var t=k(s,function(a){c.enabled(!1,a)}),u=$("<div/>");$("body").append(u),s.$on("$destroy",function(){u.detach()}),u.css({position:"absolute",top:"110%"});var v=h.parents().filter(function(){return"inline"!==$(this).css("display")}).first();u.width(v.width()),u.height(v.height()),u.append(t);var w=function(a,b,c){function d(c){return b[p]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var e=q(b),g={};angular.forEach(e,function(a){a.$$fastRepeatId||(a.$$fastRepeatId=a.id?a.id:a._id?a._id:++f),g[a.$$fastRepeatId]=a}),angular.forEach(r,function(a,b){g[b]||a.el.detach()});var i=h;angular.forEach(e,function(a){var b=a.$$fastRepeatId,e=r[b];if(e){if(!e.compiled&&(c||!angular.equals(e.copy,a))||e.compiled&&e.item!==a){var f=d(a);e.el.replaceWith(f),e.el=f,e.copy=angular.copy(a),e.compiled=!1,e.item=a}}else e={copy:angular.copy(a),item:a,el:d(a)},r[b]=e;i.after(e.el.last()),i=e.el.last()})},x=!1;a.$watch(function(a){return JSON.stringify(q(a),d)},function(b){u.width(v.width()),u.height(v.height()),x||(x=!0,g&&(m=e()),a.$$postDigest(function(){u.width(v.width()),u.height(v.height()),s.$digest(),w(t,s),g&&(m=e()-m,console.log("Total time: ",m,"ms"),console.log("time per row: ",m/b.length)),x=!1}))},!1),i.fastRepeatWatch&&a.$watch(i.fastRepeatWatch,l),a.$on("fastRepeatForceRedraw",l),h.parent().on("click","[fast-repeat-id]",function(a){var b=$(this);if(!b.parents().filter("[fast-repeat-id]").length){a.stopPropagation();var c=b.attr("fast-repeat-id"),d=s.$new(!1),e=b.find("*").index(a.target),f=d[p]=r[c].item;d.fastRepeatStatic=!1,d.fastRepeatDynamic=!0;var g;g=k(d,function(a){u.append(a)}),d.$$postDigest(function(){b.replaceWith(g),r[c]={compiled:!0,el:g,item:f},setTimeout(function(){e>=0?g.find("*").eq(e).trigger("click"):g.trigger("click")},0)}),d.$digest()}});var y=function(){u.width(v.width()),u.height(v.height())},z=$(window);z.on("resize",y),h.on("$destroy",function(){z.off("resize",y)})}}}}]);